!function(e){"use strict";var t=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(s,i){function fulfilled(e){try{step(n.next(e))}catch(e){i(e)}}function rejected(e){try{step(n.throw(e))}catch(e){i(e)}}function step(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(fulfilled,rejected)}step((n=n.apply(e,t||[])).next())})};class HTMLTableKit{constructor(e){this.nextRowId=0;const t=document.getElementById(e);if(!t)throw new Error(`Table with id "${e}" not found`);if(!(t instanceof HTMLTableElement))throw new Error(`Element with id "${e}" is not a table`);this.tableElement=t,this.tableObject=this.parseTable()}parseTable(){const e={id:this.tableElement.id||"",name:this.tableElement.getAttribute("name")||"",headers:[],hidden:{},rows:[]};return this.parseHiddenInputs(e),this.parseHeaders(e),this.parseRows(e),e}parseHiddenInputs(e){this.tableElement.querySelectorAll('input[type="hidden"]').forEach(t=>{const r=t,n=r.id||r.name;if(!n)throw new Error("Hidden input found without id or name attribute");e.hidden[n]=r.value||r.textContent||""})}parseHeaders(e){const t=this.tableElement.querySelector("thead tr")||this.tableElement.querySelector("tr:first-child");if(t){const r=t.querySelectorAll("th");if(r.length>0)r.forEach((t,r)=>{var n;const s=(null===(n=t.textContent)||void 0===n?void 0:n.trim())||`column${r+1}`;e.headers.push({name:s.toLowerCase(),type:"string"})});else{const r=t.querySelectorAll("td");r.length>0&&(this.isRowHeader(r)?r.forEach((t,r)=>{var n;const s=(null===(n=t.textContent)||void 0===n?void 0:n.trim())||`column${r+1}`;e.headers.push({name:s.toLowerCase(),type:"string"})}):this.createNumericHeaders(e,r.length))}}else{const t=this.tableElement.querySelector("tbody tr, tr");if(t){const r=t.querySelectorAll("td, th").length;this.createNumericHeaders(e,r)}}}isRowHeader(e){return Array.from(e).every(e=>{var t;const r=(null===(t=e.textContent)||void 0===t?void 0:t.trim())||"";return""!==r&&isNaN(Number(r))})}createNumericHeaders(e,t){for(let r=0;r<t;r++)e.headers.push({name:`column${r+1}`,type:"string"})}parseRows(e){const t=this.tableElement.querySelector("tbody"),r=t?t.querySelectorAll("tr"):this.tableElement.querySelectorAll("tr"),n=this.hasHeaderRow()?1:0,s=Array.from(r).slice(n),i=e.headers.map(()=>[]);s.forEach((e,t)=>{e.querySelectorAll("td, th").forEach((e,t)=>{var r;t<i.length&&i[t].push((null===(r=e.textContent)||void 0===r?void 0:r.trim())||"")})}),e.headers.forEach((e,t)=>{e.type=this.detectColumnType(i[t])}),s.forEach((t,r)=>{const n={id:this.generateRowId(t,r)};t.querySelectorAll("td, th").forEach((t,r)=>{var s;if(r<e.headers.length){const i=e.headers[r],o=(null===(s=t.textContent)||void 0===s?void 0:s.trim())||"";n[i.name]=this.parseValue(o,i.type)}}),e.rows.push(n)})}hasHeaderRow(){if(this.tableElement.querySelector("thead"))return!0;const e=this.tableElement.querySelector("tr:first-child");if(e){if(e.querySelectorAll("th").length>0)return!0;const t=e.querySelectorAll("td");return this.isRowHeader(t)}return!1}generateRowId(e,t){const r=e.getAttribute("data-id");if(r)return r;const n=`row_${t}`;return this.nextRowId=Math.max(this.nextRowId,t+1),n}detectColumnType(e){if(0===e.length)return"string";if(e.some(e=>e.includes("<")||e.includes(">")||e.length>100))return"free";const t=["true","false"];if(e.every(e=>""===e||t.includes(e.toLowerCase())))return"boolean";const r=e.filter(e=>""!==e);return 0===r.length?"string":r.every(e=>!isNaN(Number(e)))?r.some(e=>e.includes("."))?"decimal":"number":"string"}parseValue(e,t){switch(t){case"number":return""===e?null:parseInt(e,10);case"decimal":return""===e?null:parseFloat(e);case"boolean":return"true"===e.toLowerCase();default:return e}}getTable(){return this.tableObject}addRow(e){const t=Object.assign({id:e.id||"row_"+this.nextRowId++},e);return this.tableObject.headers.forEach(e=>{e.name in t||(t[e.name]=this.getDefaultValue(e.type))}),this.tableObject.rows.push(t),this.addRowToDOM(t),t}addRowAsync(e,r){return t(this,void 0,void 0,function*(){const t=Object.assign({id:e.id||"row_"+this.nextRowId++},e);if(this.tableObject.headers.forEach(e=>{e.name in t||(t[e.name]=this.getDefaultValue(e.type))}),r){const e=yield r(t);if(!e)return null;Object.assign(t,e)}return this.tableObject.rows.push(t),this.addRowToDOM(t),t})}updateRow(e,t){const r=this.tableObject.rows.findIndex(t=>t.id===e);if(-1===r)return!1;const n=this.tableObject.rows[r];return Object.assign(n,t),this.updateRowInDOM(n,r),!0}updateRowAsync(e,r,n){return t(this,void 0,void 0,function*(){const t=this.tableObject.rows.findIndex(t=>t.id===e);if(-1===t)return!1;const s=this.tableObject.rows[t];if(n){const e=yield n(s,r);if(!e)return!1;r=e}return Object.assign(s,r),this.updateRowInDOM(s,t),!0})}deleteRow(e){const t=this.tableObject.rows.findIndex(t=>t.id===e);return-1!==t&&(this.tableObject.rows.splice(t,1),this.deleteRowFromDOM(t),!0)}deleteRowAsync(e,r){return t(this,void 0,void 0,function*(){const t=this.tableObject.rows.findIndex(t=>t.id===e);if(-1===t)return!1;const n=this.tableObject.rows[t];return!(r&&!(yield r(n)))&&(this.tableObject.rows.splice(t,1),this.deleteRowFromDOM(t),!0)})}getDefaultValue(e){switch(e){case"number":case"decimal":return 0;case"boolean":return!1;default:return""}}addRowToDOM(e){const t=this.tableElement.querySelector("tbody")||this.tableElement,r=document.createElement("tr");r.setAttribute("data-id",e.id),this.tableObject.headers.forEach(t=>{const n=document.createElement("td"),s=e[t.name];"free"===t.type?n.innerHTML=s:n.textContent=String(s),r.appendChild(n)}),t.appendChild(r)}updateRowInDOM(e,t){const r=(this.tableElement.querySelector("tbody")||this.tableElement).querySelectorAll("tr")[(this.hasHeaderRow()?1:0)+t];if(!r)return;const n=r.querySelectorAll("td, th");this.tableObject.headers.forEach((t,r)=>{if(n[r]){const s=e[t.name];"free"===t.type?n[r].innerHTML=s:n[r].textContent=String(s)}})}deleteRowFromDOM(e){const t=(this.tableElement.querySelector("tbody")||this.tableElement).querySelectorAll("tr")[(this.hasHeaderRow()?1:0)+e];t&&t.remove()}refresh(){this.tableObject=this.parseTable()}}"undefined"!=typeof window&&(window.HTMLTableKit=HTMLTableKit),e.HTMLTableKit=HTMLTableKit}("undefined"!=typeof window?window:this);
//# sourceMappingURL=HTMLTableKit.standalone.min.js.map